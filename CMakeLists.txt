CMAKE_MINIMUM_REQUIRED(VERSION 2.4)

# project name
PROJECT(AstroMenace)

# depends
set(SDL_CONFIG "sdl-config" CACHE STRING "Path to sdl-config script")

FIND_PACKAGE(OpenGL REQUIRED)
IF(OPENGL_FOUND)
	INCLUDE_DIRECTORIES(${OPENGL_INCLUDE_DIR})
ELSE(OPENGL_FOUND)
	MESSAGE(FATAL "OpenGL not found")
ENDIF(OPENGL_FOUND)

FIND_PATH(FREETYPE_INCLUDE_DIR_freetype2 freetype/config/ftheader.h
  HINTS
  $ENV{FREETYPE_DIR}/include/freetype2
  PATHS
  PATH_SUFFIXES freetype2)
INCLUDE_DIRECTORIES(${FREETYPE_INCLUDE_DIR_freetype2})

FIND_PACKAGE(X11 REQUIRED)
FIND_PACKAGE(OpenAL REQUIRED)
FIND_PACKAGE(SDL REQUIRED)
FIND_PACKAGE(JPEG REQUIRED)
FIND_LIBRARY(XINERAMA_LIBRARY Xinerama)
FIND_LIBRARY(GLU_LIBRARY GLU)
FIND_LIBRARY(ALUT_LIBRARY alut)
FIND_LIBRARY(VORBIS_LIBRARY vorbis)
FIND_LIBRARY(VORBISFILE_LIBRARY vorbisfile)
FIND_LIBRARY(FREETYPE_LIBRARY freetype)

# sources
FILE(GLOB_RECURSE astromenace_SRCS AstroMenaceSource/*.cpp)

# targets
IF(DEFINED DATADIR)
	ADD_DEFINITIONS(-DDATADIR=\\"${DATADIR}\\")
ENDIF(DEFINED DATADIR)
EXEC_PROGRAM(${SDL_CONFIG} ARGS "--cflags" OUTPUT_VARIABLE SDL_CFLAGS)
EXEC_PROGRAM(${SDL_CONFIG} ARGS "--libs" OUTPUT_VARIABLE SDL_LIBS)

# we need all speed optimization flags, this could add up to 40% FPS in game
ADD_DEFINITIONS(${SDL_CFLAGS} "-s -O -O1 -O2 -O3 -Os -fomit-frame-pointer")
ADD_EXECUTABLE(AstroMenace ${astromenace_SRCS})
TARGET_LINK_LIBRARIES(AstroMenace ${X11_LIBRARIES} ${SDL_LIBS} ${OPENGL_gl_LIBRARY} ${OPENAL_LIBRARY} ${FREETYPE_LIBRARY} ${JPEG_LIBRARY} ${XINERAMA_LIBRARY} ${GLU_LIBRARY} ${ALUT_LIBRARY} ${VORBIS_LIBRARY} ${VORBISFILE_LIBRARY})
